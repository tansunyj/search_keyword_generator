# 独立代理服务器

这是一个用于转发AI API请求的独立代理服务器，可以解决跨域问题并提供详细的日志记录。

## 功能特点

- 完整的请求和响应日志记录
- 自动处理CORS（跨域资源共享）
- 请求和响应超时处理（2分钟）
- 详细的错误报告
- 健康检查端点

## 安装依赖

确保已安装所需的依赖：

```bash
npm install express body-parser https cors morgan
```

## 使用方法

### 启动代理服务器

```bash
npm run proxy
```

或者直接运行：

```bash
node proxy-server.js
```

服务器将在端口3001上启动（可通过环境变量PORT修改）。

### 配置客户端

在客户端代码中，将API请求指向代理服务器：

```typescript
// 例如在aiService.ts中
this.apiUrl = 'http://localhost:3001/api/chat/completions';
```

## 请求流程

1. 客户端发送请求到代理服务器 `http://localhost:3001/api/...`
2. 代理服务器将请求转发到目标服务器 `https://openkey.cloud/v1/...`
3. 代理服务器接收目标服务器的响应并转发回客户端

## 日志记录

代理服务器会记录详细的请求和响应信息，包括：

- 请求开始时间和方法
- 请求体预览
- 响应状态码
- 响应完成时间和耗时
- 响应内容预览
- 错误详情（如有）

## 健康检查

访问 `http://localhost:3001/health` 可以检查代理服务器是否正常运行。

## 常见问题排查

### 504 Gateway Timeout

如果遇到504超时错误，可能是因为：

1. 目标服务器响应时间过长
2. 网络连接问题
3. 请求体过大

可以尝试：
- 增加超时时间（目前设置为2分钟）
- 检查网络连接
- 减小请求体大小

### 401 Unauthorized

如果遇到401未授权错误，请检查：

1. API密钥是否正确设置
2. Authorization头是否正确传递

### 其他问题

如果遇到其他问题，请查看控制台日志，其中包含详细的错误信息和请求/响应数据。 